/* Copyright 2023 WebGear en EvoStack. All rights reserved. */
(()=>{fabric.Postit=fabric.util.createClass(fabric.Group,{type:"postit",initialize(i,e){this.tbox=new fabric.Textbox(i,{left:0,top:0,originY:"center",originX:"center",textAlign:"center",padding:10,fontSize:20,fontFamily:"Sans-serif",fontStyle:"normal",fontWeight:400}),this.note=new fabric.Rect({left:0,top:0,originY:"top",originX:"center",fill:"#ffffaa",rx:5,ry:5}),this.strip=new fabric.Rect({left:0,top:0,originY:"top",originX:"center",height:30,fill:"#ffff00"}),Object.defineProperty(this,"text",{get:()=>this.tbox.text,set:t=>this.tbox.set("text",t)}),Object.defineProperty(this,"textPadding",{get:()=>this.tbox.padding,set:t=>this.tbox.set("padding",t)}),Object.defineProperty(this,"textAlign",{get:()=>this.tbox.textAlign,set:t=>this.tbox.set("textAlign",t)}),Object.defineProperty(this,"fontSize",{get:()=>this.tbox.fontSize,set:t=>this.tbox.set("fontSize",t)}),Object.defineProperty(this,"fontWeight",{get:()=>this.tbox.fontWeight,set:t=>this.tbox.set("fontWeight",t)}),Object.defineProperty(this,"fontStyle",{get:()=>this.tbox.fontStyle,set:t=>this.tbox.set("fontStyle",t)}),Object.defineProperty(this,"fontFamily",{get:()=>this.tbox.fontFamily,set:t=>this.tbox.set("fontFamily",t)}),Object.defineProperty(this,"textColor",{get:()=>this.tbox.fill,set:t=>this.tbox.set("fill",t)}),Object.defineProperty(this,"noteColor",{get:()=>this.note.fill,set:t=>this.note.set("fill",t)}),Object.defineProperty(this,"boxShadow",{get:()=>this.shadow,set:t=>this.set("shadow",t)}),Object.defineProperty(this,"radius",{get:()=>this.note.rx,set:t=>this.note.set({rx:t,ry:t})}),Object.defineProperty(this,"stripHeight",{get:()=>this.strip.height,set:t=>this.strip.set("height",t)}),Object.defineProperty(this,"stripColor",{get:()=>this.strip.fill,set:t=>this.strip.set("fill",t)}),this.on("scaling",this._onScale.bind(this)),this.on("mousedblclick",this._enterEditing.bind(this)),this.tbox.on("changed",this._onChange.bind(this)),this.tbox.on("selection:changed",this._onChange.bind(this)),this.callSuper("initialize",[this.note,this.strip,this.tbox],{lockScalingFlip:!0,boxShadow:"rgba(0,0,0,0.3) 3px 3px 3px",...e}),this.setCoords()},_enterEditing(){this.canvas.setActiveObject(this.tbox),this.tbox.bringToFront(),this.tbox.enterEditing(),this.tbox.selectAll(),this._onChange()},_onChange(){this.setCoords()},_onScale(){let i=Math.abs(this.scaleX),e=Math.abs(this.scaleY);this.set({scaleX:1,scaleY:1,width:this.width*i,height:this.height*e}),this.setCoords()},setCoords(){this.tbox.set({top:this.strip.height/2,width:this.width-this.tbox.padding*2,height:this.height-this.strip.height-this.tbox.padding*2}),this.tbox.setCoords();let i=this.tbox.width+this.tbox.padding*2,e=Math.max(this.tbox.height+this.strip.height+this.tbox.padding*2,this.height);this.set({scaleX:1,scaleY:1,width:i,height:e}),this.note.set({width:i,height:e,top:-e/2}),this.strip.set({width:i,top:-this.height/2}),this.callSuper("setCoords"),this.canvas?.requestRenderAll()},toObject(i){let e=["text","textPadding","textAlign","fontSize","fontFamily","fontStyle","fontWeight","textColor","noteColor","boxShadow","radius","stripHeight","stripColor",...i??[]];return fabric.util.object.extend(this.callSuper("toObject",e))}});fabric.Postit.fromObject=function(i,e){return fabric.Object._fromObject("Postit",i,e,"text")};})();
